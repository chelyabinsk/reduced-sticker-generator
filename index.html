<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" /> 
<style>
html, body {
  width:  100%;
  height: 100%;
  margin: 0;
}
</style>
</head>
<body>

<canvas id="myCanvas" width="10000" height="1000"
style="border:0px solid #c3c3c3;">
Your browser does not support the canvas element.
</canvas>

<script>
var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");
ctx.canvas.width  = window.innerWidth - 100;
ctx.canvas.height = window.innerHeight - 100;
var encodings = ["11011001100","11001101100","11001100110","10010011000","10010001100","10001001100","10011001000","10011000100","10001100100","11001001000","11001000100","11000100100","10110011100","10011011100","10011001110","10111001100","10011101100","10011100110","11001110010","11001011100","11001001110","11011100100","11001110100","11101101110","11101001100","11100101100","11100100110","11101100100","11100110100","11100110010","11011011000","11011000110","11000110110","10100011000","10001011000","10001000110","10110001000","10001101000","10001100010","11010001000","11000101000","11000100010","10110111000","10110001110","10001101110","10111011000","10111000110","10001110110","11101110110","11010001110","11000101110","11011101000","11011100010","11011101110","11101011000","11101000110","11100010110","11101101000","11101100010","11100011010","11101111010","11001000010","11110001010","10100110000","10100001100","10010110000","10010000110","10000101100","10000100110","10110010000","10110000100","10011010000","10011000010","0100","10000110010","11000010010","11001010000","11110111010","11000010100","10001111010","10100111100","10010111100","10010011110","10111100100","10011110100","10011110010","11110100100","11110010100","11110010010","11011011110","11011110110","11110110110","10101111000","10100011110","10001011110","10111101000","10111100010","11110101000","11110100010","10111011110","10111101110","11101011110","11110101110","11010000100","11010010000","11010011100","11000111010"];
var charSetA = [" ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","\\",  "]",  "^","_","NUL","SOH","STX","ETX","EOT","ENQ","ACK","BEL","BS","HT","LF","VT","FF","CR","SO","SI","DLE","DC1","DC2","DC3","DC4","NAK","SYN","ETB","CAN","EM","SUB","ESC","FS","GS","RS","US","FNC3","FNC2","SHIFT","Code C","Code B","FNC4","FNC1","START A","START B","START C","STOP"];
var charSetB = [" ","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","\\","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","DEL","FNC3","FNC2","SHIFT","Code C","FNC4","Code A","FNC1","START A","START B","START C","STOP"];
var charSetC = ["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","Code B","Code A","FNC1","START A","START B","START C","STOP"];
 

function drawBox(x1,y1,x2,y2)
{
ctx.fillStyle = "#000000";
ctx.fillRect(x1,y1,x2,y2);
}

function workoutCheckSum(message,type)
{
 // go through all of the letters in the message to workout their sum weight


 if(type == "A")
 {
  totalWeight = 103; // Assume that is is always CharSetA. Add the "START A" weight
 
  for(i=0;i<message.length;i++)
  {
   totalWeight += (i + 1) * charSetA.indexOf(message[i]);
  }
 }
 else if(type == "C")
 {
  totalWeight = 105; // Assume that is is always CharSetA. Add the "START A" weight
  var count = 1;
  for(i=0;i<message.length;i = i + 2)
  {
   totalWeight += count * parseInt(message[i] + message[i+1]);
   count++;
  }
 }

 

 checkSum = totalWeight % 103;

 if(checkSum < 10)
 {
  checkSum = "0" + checkSum.toString();
 }
 else
 {
  checkSum = checkSum.toString();
 }

 return checkSum;
}


function encodeMessage(message,type)
{
 
 //var message = "971501342701375630005504";
 //var message = "9715";

 var checkSum = 0;
 
 var encodedMessage = "";

 //var type = "C";

 if(type == "A")
 {
  encodedMessage = encodings[charSetA.indexOf("START A")]; // Assume for now, that it's always CharSetA
  checkSum = workoutCheckSum(message,"A");

  for(i=0;i<message.length;i++)
  {
 
   encodedMessage += encodings[charSetA.indexOf(message[i])];
   //console.log(encodedMessage);
  }
 }
 else if(type == "B")
 {

 }
 else if(type == "C")
 {
  encodedMessage = encodings[charSetA.indexOf("START C")]; // Assume for now, that it's always CharSetA
  checkSum = workoutCheckSum(message,"C");
  for(i=0;i<message.length;i = i + 2)
  {
   encodedMessage += encodings[charSetC.indexOf(message[i] + message[i+1])];
   //console.log(message[i] + message[i+1]);
  }
 }

 //console.log(encodedMessage);
 //console.log(checkSum);

 

 encodedMessage += encodings[charSetC.indexOf(checkSum)] + encodings[charSetA.indexOf("STOP")]+"11";

 
 return encodedMessage;
 
}

function drawBarcode(message,type)
{
 var width = 10;
 var height = 3000;
 var rightWidth = width*10;
 var aboveWidth = 10;
 
 var msg = encodeMessage(message,type);

 for(i=0;i<msg.length;i++)
 {
  if(msg[i] == "1")
  {
   drawBox(rightWidth + i*width,aboveWidth,width,aboveWidth + height);
  }
 }
}

function inputDialog()
{
 var message = prompt("Please enter message");
 var type = prompt("Please enter type (A or C)");

 drawBarcode(message,type);
}


async function generateTrialCodes(productID,price)
{
 // Since there are 10 possible combinations, this funcion will generate all of them
 // and then for each it will call the checksum function
 // and then prints the full barcode
 
 var prefixCode = "971" + productID;
 var paddedPrice = "";
 var tmpCode = "";
 
 // Since price is usually preceeded by 0s this if statement adds appropriate number of 0s
 if(parseInt(price) < 10)
  paddedPrice = "0000" + price;
 else if(parseInt(price) < 100)
  paddedPrice = "000" + price;
 else if(parseInt(price) < 1000)
  paddedPrice = "00" + price;
 else if(parseInt(price) < 10000)
  paddedPrice = "0" + price;
 else
  paddedPrice = price;

 while(true)
 {
 
  // Loop to go through all of the possible values for unknown position 
  for(j=0;j<10;j++)
  {
    //console.log(prefixCode + i.toString() + paddedPrice);
    tmpCode = prefixCode + j.toString() + paddedPrice + "0" + tescoChecksum((prefixCode + j.toString() + paddedPrice));  
    //console.log(tescoChecksum((prefixCode + j.toString() + paddedPrice)));
    
    //console.log(tmpCode + " " + j);
    clearCanvas();
    drawBarcode(tmpCode,"C");
    await sleep(100);  
  }  // End of for loop
 }  // End of while loop
}

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

function tescoChecksum(value)
{
 // Function that works out the last digit in of the reduced barcode
 var checksum = 0;

 for(i=0;i<value.length;i++)
 {
  // If even position
  if( (i+1)%2 == 0)
  {
   checksum += parseInt(value[i]);
  }
  // If odd position
  else
  {
   checksum += 3*parseInt(value[i]);
  }
  //console.log(value + "  " +checksum + " " + value[i] + " " + i);
 }
 
 checksum = 10 - (checksum % 10);
 if(checksum != 10)
  return checksum;
 else
  return 0;
}

function clearCanvas()
{
 ctx.clearRect(0, 0, canvas.width, canvas.height);
}


//inputDialog();


function betterDialog()
{
 var code = prompt("Please enter code...");
 var price = prompt("Please enter price", 53);
 generateTrialCodes(code,price);
}

betterDialog();




window.onresize = function()
{
    var canvas = document.getElementById('myCanvas');
    canvas.width = window.innerWidth;
    canvas.style.width = window.innerWidth;
    canvas.height = window.innerHeight;
    canvas.style.height = window.innerHeight;
}

</script>

</body>
</html>
